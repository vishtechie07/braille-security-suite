package com.example.brailleapp.security;

import java.util.Date;

/**
 * Represents a security vulnerability discovered during penetration testing
 */
public class SecurityVulnerability {
    private String type;
    private String description;
    private VulnerabilityLevel level;
    private Date discoveredAt;
    private String remediation;
    private String cveId;
    private String owaspCategory;
    
    public SecurityVulnerability(String type, String description, VulnerabilityLevel level, Date discoveredAt) {
        this.type = type;
        this.description = description;
        this.level = level;
        this.discoveredAt = discoveredAt;
        this.remediation = generateRemediation(type, level);
        this.owaspCategory = getOwaspCategory(type);
    }
    
    /**
     * Generate remediation advice based on vulnerability type and level
     */
    private String generateRemediation(String type, VulnerabilityLevel level) {
        switch (type) {
            case "SQL_INJECTION":
                return "Use parameterized queries and input validation. Implement proper SQL injection prevention measures.";
            case "XSS":
                return "Implement proper output encoding and input validation. Use Content Security Policy (CSP).";
            case "COMMAND_INJECTION":
                return "Avoid executing user input as commands. Use whitelist validation and proper escaping.";
            case "MALICIOUS_FILE_UPLOAD":
                return "Implement file type validation, virus scanning, and secure file storage.";
            case "PATH_TRAVERSAL":
                return "Validate and sanitize file paths. Use whitelist-based file access controls.";
            case "WEAK_PASSWORD":
                return "Enforce strong password policies and implement password complexity requirements.";
            case "DEFAULT_CREDENTIALS":
                return "Change all default credentials and implement proper authentication mechanisms.";
            case "INFORMATION_DISCLOSURE":
                return "Remove sensitive information from error messages and logs. Implement proper access controls.";
            case "SESSION_EXPOSURE":
                return "Secure session management and avoid exposing session information in URLs.";
            case "INPUT_VALIDATION_BYPASS":
                return "Implement comprehensive input validation and length limits.";
            case "SPECIAL_CHARACTERS":
                return "Properly escape and validate special characters in user input.";
            default:
                return "Review security controls and implement appropriate countermeasures.";
        }
    }
    
    /**
     * Get OWASP category for vulnerability type
     */
    private String getOwaspCategory(String type) {
        switch (type) {
            case "SQL_INJECTION":
                return "A03:2021 - Injection";
            case "XSS":
                return "A03:2021 - Injection";
            case "COMMAND_INJECTION":
                return "A03:2021 - Injection";
            case "MALICIOUS_FILE_UPLOAD":
                return "A01:2021 - Broken Access Control";
            case "PATH_TRAVERSAL":
                return "A01:2021 - Broken Access Control";
            case "WEAK_PASSWORD":
                return "A07:2021 - Identification and Authentication Failures";
            case "DEFAULT_CREDENTIALS":
                return "A07:2021 - Identification and Authentication Failures";
            case "INFORMATION_DISCLOSURE":
                return "A09:2021 - Security Logging and Monitoring Failures";
            case "SESSION_EXPOSURE":
                return "A07:2021 - Identification and Authentication Failures";
            case "INPUT_VALIDATION_BYPASS":
                return "A03:2021 - Injection";
            case "SPECIAL_CHARACTERS":
                return "A03:2021 - Injection";
            default:
                return "A99:2021 - Other";
        }
    }
    
    // Getters and Setters
    public String getType() {
        return type;
    }
    
    public void setType(String type) {
        this.type = type;
    }
    
    public String getDescription() {
        return description;
    }
    
    public void setDescription(String description) {
        this.description = description;
    }
    
    public VulnerabilityLevel getLevel() {
        return level;
    }
    
    public void setLevel(VulnerabilityLevel level) {
        this.level = level;
    }
    
    public Date getDiscoveredAt() {
        return discoveredAt;
    }
    
    public void setDiscoveredAt(Date discoveredAt) {
        this.discoveredAt = discoveredAt;
    }
    
    public String getRemediation() {
        return remediation;
    }
    
    public void setRemediation(String remediation) {
        this.remediation = remediation;
    }
    
    public String getCveId() {
        return cveId;
    }
    
    public void setCveId(String cveId) {
        this.cveId = cveId;
    }
    
    public String getOwaspCategory() {
        return owaspCategory;
    }
    
    public void setOwaspCategory(String owaspCategory) {
        this.owaspCategory = owaspCategory;
    }
    
    @Override
    public String toString() {
        return String.format("[%s] %s: %s", level, type, description);
    }
}
